#include "yawn.h"
#include "HaarCascadeObjectDetector.h"

#include<iostream>
#include<stdio.h>

using namespace cv;
using namespace std;

//global variables ______________________________________________
string face_cascade="haarcascades/haarcascade_frontalface_alt.xml";
string eye_cascade="haarcascades/haarcascade_eye_tree_eyeglasses.xml";
string mouth_cascade="haarcascades/haarcascade_mcs_mouth.xml";
// _______________________________________________________________

void displayFeatures(Mat &frame, const vector<Rect> &rects, Point p=Point(0,0));

int main()
{
	HaarCascadeObjectDetector faceDetector(face_cascade);
	HaarCascadeObjectDetector eyeDetector(eye_cascade);
	HaarCascadeObjectDetector mouthDetector(mouth_cascade);
	Mat src=imread("images/aloma1.jpg");

	Mat gray;
	cvtColor(src,gray,CV_BGR2GRAY);

	cv::equalizeHist(gray,gray);
	vector<Rect> faces;
	faceDetector.setOptions(CV_HAAR_FIND_BIGGEST_OBJECT);
	if(faceDetector.detect(gray,faces))
	{
	displayFeatures(src,faces);

	Rect face=faces[0];
	Rect lower_face(face.x,face.y+0.75*face.height,face.width,face.height*0.40);
	imshow("a",gray(lower_face));

	vector<Rect> mouths;
	int yawn_area=0;
	mouthDetector.setOptions(CV_HAAR_FIND_BIGGEST_OBJECT);
	mouthDetector.setMinNeighbors(3);
	if(mouthDetector.detect(gray(lower_face),mouths))
	{
	Mat mouthroi=(gray(lower_face))(mouths[0]);
	yawn_area=getMaxArea(mouthroi);
	displayFeatures(src,mouths,Point(lower_face.x,lower_face.y));
	cout<<"yawn area"<<yawn_area;
	}

	}
	imshow("Image",src);
	waitKey(0);


}
void displayFeatures(Mat &frame, const vector<Rect> &rects,Point offset)
{
	Scalar red(0,0,255);
	int thickness=3;
	for(size_t i=0;i<rects.size();i++)
	{
		Rect rect(Point(rects[i].x+offset.x,rects[i].y+offset.y),Size(rects[i].width,rects[i].height));

		cv::rectangle(frame,rect,red,thickness);

	}
}
